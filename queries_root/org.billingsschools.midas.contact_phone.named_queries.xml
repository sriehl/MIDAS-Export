<?xml version="1.0"?>
<queries>
  <query name="org.billingsschools.midas.contact_phone" coreTable="STUDENTS" flattened="true" tags="">
    <summary>MIDAS Contact Phone</summary>
    <description>MIDAS Contact Phone data</description>
    <columns>
      <column column="STUDENTS.ID">user_id</column>
      <column column="STUDENTS.HOME_PHONE">country_code_id</column>
      <column column="STUDENTS.HOME_PHONE">main_number</column>
      <column column="STUDENTS.HOME_PHONE">extension</column>
      <column column="STUDENTS.HOME_PHONE">carrier_id</column>
    </columns>
    <sql>
      <![CDATA[
        select
            students.psguid "user_id"
          , '232' "country_code_id"
          , regexp_replace(students.home_phone, '\D+') "main_number"
          , '' "extension"
          , '' "carrier_id"
        from
          students
        where
          students.home_phone is not null
          and length(regexp_replace(students.home_phone, '\D+')) = 10
      ]]>
    </sql>
  </query>
</queries>
